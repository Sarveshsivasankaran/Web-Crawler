<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | WebCrawler</title>
    <link rel="stylesheet" href="../static/style.css" />
  </head>
  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="logo">üï∑Ô∏è <span>WebCrawler</span></div>
      <nav>
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('signup') }}" class="btn primary">Sign Up</a>
      </nav>
    </header>

    <!-- LOGIN FORM -->
    <section class="auth">
      <div class="auth-box">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required />
        <button class="btn primary" id="confirmLogin">Login</button>

        <p>
          Don‚Äôt have an account?
          <a href="{{ url_for('signup') }}">Sign up</a>
        </p>
        <div
          id="loginMessage"
          style="margin-top: 10px; color: var(--normal)"
        ></div>
      </div>
    </section>

    <footer>
      <p>¬© 2025 WebCrawler. Built by Levellers.</p>
    </footer>

    <script>
      const loginBtn = document.getElementById("confirmLogin");
      const msgDiv = document.getElementById("loginMessage");

      loginBtn.addEventListener("click", async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!email || !password) {
          msgDiv.textContent = "‚ö†Ô∏è Please fill in all fields.";
          return;
        }

        msgDiv.textContent = "üîç Logging in...";

        try {
          const res = await fetch("/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const data = await res.json();

          if (res.ok) {
            msgDiv.textContent = "‚úÖ Login successful! Redirecting...";
            setTimeout(() => {
              window.location.href = "{{ url_for('dashboard') }}";
            }, 1000);
          } else {
            msgDiv.textContent = `‚ùå ${data.error || "Invalid credentials"}`;
          }
        } catch (err) {
          msgDiv.textContent = "üö® Error connecting to server.";
        }
      });
    </script>
  </body>
</html>
