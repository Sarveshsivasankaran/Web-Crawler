<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard | WebCrawler</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='/style.css') }}" />
    <link rel="icon" href="{{ url_for('static', filename='/templates/img/icon.png') }}" />
  </head>

  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="logo">ğŸ•·ï¸ WebCrawler</div>
      <div class="nav-links">
        <a href="{{ url_for('index') }}">ğŸ  Home</a>
        <a href="{{ url_for('history') }}">ğŸ“œ History</a>
        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="dashboard-container">
      <div class="crawl-box">
        <div class="crawl-header">
          <h1>AI Web Crawler</h1>
          <p>
            Paste any URL below and let Gemini summarize and analyze it
            intelligently.
          </p>
        </div>

        <div class="crawl-input-area">
          <input
            type="text"
            id="urlInput"
            placeholder="ğŸ”— https://example.com"
          />
          <button class="btncrawl" id="startCrawl">Crawl Now</button>
        </div>

        <div id="crawlResult"></div>
      </div>
    </div>

    <footer>Â© 2025 WebCrawler | Built with ğŸ’¡ by Levellers</footer>

    <script>
      const crawlBtn = document.getElementById("startCrawl");
      const resultDiv = document.getElementById("crawlResult");

      crawlBtn.addEventListener("click", async () => {
        const url = document.getElementById("urlInput").value.trim();

        if (!url) {
          resultDiv.innerText = "âš ï¸ Please enter a valid URL.";
          return;
        }

        resultDiv.innerText = "ğŸ§  Fetching and analyzing...";

        try {
          const res = await fetch("/crawl", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url }),
            credentials: "include",
          });

          const data = await res.json();

          if (res.ok) {
            resultDiv.innerHTML = `
              <h3>${data.title || "Untitled Page"}</h3>
              <p><strong>URL:</strong> <a href="${data.url}" target="_blank">${
              data.url
            }</a></p>
              <p><strong>Summary:</strong></p>
              <pre>${data.summary}</pre>
              <p style="color:gray;">âœ… Saved to your crawl history.</p>
            `;
          } else {
            resultDiv.innerText = data.error || "âŒ Crawl failed.";
          }
        } catch (err) {
          resultDiv.innerText = "ğŸš¨ Error connecting to server.";
        }
      });
    </script>
  </body>
</html>