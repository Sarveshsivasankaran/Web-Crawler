<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | WebCrawler</title>
    <link rel="stylesheet" href="/static/style.css"/>
    <link rel="icon" href="/static/img/icon.png" />
  </head>
  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="logo">üï∑Ô∏è <span>WebCrawler</span></div>
      <nav>
        <a href="/index.html">Home</a>
        <a href="/signup.html" class="btn primary">Sign Up</a>
      </nav>
    </header>

    <!-- LOGIN FORM -->
    <section class="auth">
      <div class="auth-box">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required />
        <button class="btn primary" id="confirmLogin">Login</button>

        <p>
          Don‚Äôt have an account?
          <a href="/signup.html">Sign up</a>
        </p>
        <div
          id="loginMessage"
          style="margin-top: 10px; color: var(--normal)"
        ></div>
      </div>
    </section>

    <footer>
      <p>¬© 2025 WebCrawler. Built by Levellers.</p>
    </footer>
        <script>
      const API_BASE = "https://web-crawler-backend-51dl.onrender.com";

      const loginBtn = document.getElementById("confirmLogin");
      const msgDiv = document.getElementById("loginMessage");

      loginBtn.addEventListener("click", async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!email || !password) {
          msgDiv.textContent = "‚ö†Ô∏è Please fill in all fields.";
          return;
        }

        msgDiv.textContent = "üîç Logging in...";

        try {
          const res = await fetch(`${API_BASE}/login`, {
            method: "POST",
            credentials: "include",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ email, password })
          });

          const data = await res.json();

          if (!res.ok) {
            msgDiv.textContent = `‚ùå ${data.error || "Invalid credentials"}`;
            return;
          }

          msgDiv.textContent = "‚úÖ Login successful! Redirecting...";
          setTimeout(() => {
            window.location.href = "/dashboard.html";
          }, 1000);

        } catch (err) {
          console.error(err);
          msgDiv.textContent = "üö® Error connecting to server.";
        }
      });
    </script>
  </body>
</html>